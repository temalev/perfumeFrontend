<template>
  <div class="layout">
    <Head>
      <Title>–ü–∞—Ä—Ñ–ë—é—Ä–æ - –æ—Ä–∏–≥–∏–Ω–∞–ª—ã –º–∏—Ä–æ–≤—ã—Ö –±—Ä–µ–Ω–¥–æ–≤</Title>
      <Link
        rel="icon"
        href="https://parfburo.com/favicon.ico"
        type="image/x-icon"
      />
    </Head>
    <Header @login="isLoginModal = true" @openShopBag="isDrawer = true" />
    <div class="main">
      <slot />
      <Footer @onInfoModal="onInfoModal" />
    </div>
    <mobile-panel @login="isLoginModal = true" @openShopBag="isDrawer = true" />
    <UiModal
      v-if="isDeliveryModal"
      @close="isDeliveryModal = false"
      header="–î–æ—Å—Ç–∞–≤–∫–∞"
    >
      <div class="modal-body">
        <p>
          üìç–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –†–æ—Å—Å–∏–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–µ–π CDEK (–æ–ø–ª–∞—Ç–∞ –Ω–∞
          —Å–∞–π—Ç–µ/–Ω–∞–ª–æ–∂–µ–Ω–Ω—ã–π –ø–ª–∞—Ç–µ–∂) - —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å–¥—ç–∫ —Å–∞–º —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤ —Å–≤–æ–µ–º
          –ø–ª–∞–≥–∏–Ω–µ –∏–ª–∏ —Ö–∑ –∫–∞–∫ —ç—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è, —Ç–∞–º –∂–µ –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –ø—É–Ω–∫—Ç –∏
          –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∏–Ω—Ñ—É –æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ
        </p>
        <p>
          üìç–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –ú–æ—Å–∫–≤–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ú–ö–ê–î –∫—É—Ä—å–µ—Ä–æ–º (–æ–ø–ª–∞—Ç–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏
          –Ω–∞–ª–∏—á–Ω—ã–º–∏/–æ–ø–ª–∞—Ç–∞ –Ω–∞ —Å–∞–π—Ç–µ) - 500‚ÇΩ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ –¥–æ 10.000‚ÇΩ, –±–µ—Å–ø–ª–∞—Ç–Ω–æ –ø—Ä–∏
          –∑–∞–∫–∞–∑–µ –æ—Ç 10.000‚ÇΩ
        </p>
        <p>
          üìç–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –ú–æ—Å–∫–≤–µ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –ú–ö–ê–î –∫—É—Ä—å–µ—Ä–æ–º (–æ–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏ –ø—Ä–∏
          –ø–æ–ª—É—á–µ–Ω–∏–∏/–æ–ø–ª–∞—Ç–∞ –Ω–∞ —Å–∞–π—Ç–µ) - —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ. 800‚ÇΩ + 25‚ÇΩ
          –∑–∞ –∫–∞–∂–¥—ã–π –∫–∏–ª–æ–º–µ—Ç—Ä —É–¥–∞–ª–µ–Ω–Ω–æ—Å—Ç–∏ –æ—Ç –ú–ö–ê–î
        </p>
        <p>
          üìç–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –†—è–∑–∞–Ω–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –≥–æ—Ä–æ–¥–∞, –Ø–Ω–¥–µ–∫—Å.Go (–æ–ø–ª–∞—Ç–∞ –Ω–∞ —Å–∞–π—Ç–µ)
          –ü—Ä–∏ –∑–∞–∫–∞–∑–µ –¥–æ 10.000‚ÇΩ - 350‚ÇΩ, –ø—Ä–∏ –∑–∞–∫–∞–∑–µ –æ—Ç 10.000‚ÇΩ - –±–µ—Å–ø–ª–∞—Ç–Ω–æ
        </p>
      </div>
    </UiModal>
    <shop-bag v-if="isDrawer" :user="user" @close="isDrawer = false" />
    <log-in
      v-if="isLoginModal"
      @close="isLoginModal = false"
      @success="$router.push('userCard')"
    />
  </div>
</template>

<script>
import { getMe, addToFavorites } from '@/api/productApi.js';
import MobilePanel from '~/components/MobilePanel.vue';
import ShopBag from '~/components/ShopBag.vue';
import LogIn from '~/components/LogIn.vue';

export default {
  components: { MobilePanel, ShopBag, LogIn },
  data() {
    return {
      isModal: false,
      token: null, // –•—Ä–∞–Ω–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
      user: null,
      favorites: [],
      isDeliveryModal: false,
      isDrawer: false,
      isLoginModal: false,
    };
  },
  mounted() {
    this.user = useState('user', () => null);
    this.getMe();
    useState('ordersSlugs', () => {
      const slugs = window.localStorage.getItem('ordersSlugs');
      return slugs ? slugs.split(',') : [];
    });
    this.favorites = useState('favoritesSlugs', () => []);
  },
  watch: {
    favorites(val) {
      if (val.length) {
        this.addToFavorites(val);
      }
    },
  },
  methods: {
    onInfoModal(modal) {
      if (modal === 'delivery') {
        this.isDeliveryModal = true;
      }
    },
    async getMe() {
      try {
        const res = await getMe();
        this.user = res;
      } catch (e) {
        console.error(e);
      }
    },
    async addToFavorites(slug) {
      try {
        const res = await addToFavorites(slug);
      } catch (e) {
        console.error(e);
      }
    },
  },
};
</script>

<style scoped lang="scss">
.layout {
  display: flex;
  flex-direction: column;
  overflow: auto;
  height: 100vh;
}

.main {
  overflow: auto;
  height: calc(100vh - 50px);
}

.modal-body {
  padding: 0 20px;
  margin-bottom: 20px;
  max-width: 600px;
  overflow: auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

@media (max-width: 500px) {
  .main {
    margin-bottom: 60px;
  }
}
</style>
